PLAYER_WIDTH equ 2 ;in bytes
PLAYER_HEIGHT equ 24 ;in lines
PLAYER_BOUNDING_BOX_OFFSET_X equ 1
PLAYER_BOUNDING_BOX_OFFSET_Y equ 15
PLAYER_BOUNDING_BOX_HEIGHT equ 5
PLAYER_FRAME_SIZE equ 48
PLAYER_INK_COLOUR equ %01000010

PLAYER_MIN_X equ 3
PLAYER_MAX_X equ BUFFER_WINDOW_WIDTH-PLAYER_WIDTH-3
PLAYER_MIN_Y equ 4
PLAYER_MAX_Y equ 192-24

PLAYER_SPEED_X equ 1
PLAYER_SPEED_Y equ 8
PLAYER_SKI_SPEED_FAST equ 8
PLAYER_SKI_SPEED_MEDIUM equ 4
PLAYER_SKI_SPEED_SLOW equ 2

PLAYER_SKI_ICON_OFFSET_X equ 1

player_direction db DOWN
player_state db NO_SKI
player_current_frame db 0
player_anim_timer db 0
playery db 0
playerx db 12
collision_detected_player_shop db FALSE

has_ski db 0

;;;;;;;;;;; sprite data ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; ASM data file from a ZX-Paintbrush picture with 16 x 24 pixels (= 2 x 3 characters)
; line based output of pixel data:
playersprite_up:
    ;frame0
    db %00001010, %10100000
    db %00011111, %11100000
    db %00011111, %11100000
    db %00011111, %11100000
    db %00011111, %11100000
    db %00011111, %11100000
    db %00001111, %11100000
    db %00000111, %11000000
    db %00011111, %11110000
    db %00111111, %11111000
    db %01111000, %00111000
    db %01001111, %11100100
    db %01111111, %11111100
    db %01001111, %11100100
    db %01000111, %11000100
    db %01000111, %11000100
    db %00111111, %11111000
    db %00001110, %11100000
    db %00001100, %01100000
    db %00001110, %11100000
    db %00001110, %11100000
    db %00010010, %10010000
    db %00100010, %10001000
    db %00111110, %11111000
    ;frame1
    db %00001001, %00100000
    db %00001101, %10110000
    db %00001111, %11110000
    db %00001111, %11110000
    db %00001011, %11110000
    db %00011101, %11110000
    db %00010001, %11100000
    db %00001001, %11000000
    db %00000111, %11110000
    db %00001111, %11111000
    db %00011110, %00011100
    db %00010011, %11110100
    db %00011111, %11111100
    db %00010001, %11100100
    db %00001000, %11101000
    db %00001000, %11110000
    db %00001111, %11100000
    db %00011110, %11100000
    db %00011100, %01110000
    db %00001110, %11110000
    db %00001011, %11100000
    db %00010001, %00100000
    db %00001111, %00010000
    db %00000001, %11110000
    ;frame2
    db %00000100, %10010000
    db %00001101, %10110000
    db %00001111, %11110000
    db %00001111, %11110000
    db %00001111, %11010000
    db %00001111, %10111000
    db %00000111, %10001000
    db %00000011, %10010000
    db %00001111, %11100000
    db %00011111, %11110000
    db %00111000, %01111000
    db %00101111, %11001000
    db %00111111, %11111000
    db %00100111, %10001000
    db %00010111, %00010000
    db %00001111, %00010000
    db %00000111, %11110000
    db %00000111, %01111000
    db %00001110, %00111000
    db %00001111, %01110000
    db %00000111, %11010000
    db %00000100, %10001000
    db %00001000, %11110000
    db %00001111, %10000000
playersprite_down:
    ;frame0
    db %00001001, %00100000
    db %00001101, %10110000
    db %00001111, %11110000
    db %00001011, %10110000
    db %00001000, %00110000
    db %00001010, %10010000
    db %00001000, %00100000
    db %00000101, %10100000
    db %00011100, %01110000
    db %00111111, %11111000
    db %01111100, %01111000
    db %01001100, %01100100
    db %01111100, %01111100
    db %01001110, %11100100
    db %01000110, %11000100
    db %01000111, %11000100
    db %00111111, %11111000
    db %00001110, %11100000
    db %00001100, %01100000
    db %00001110, %11100000
    db %00001110, %11100000
    db %00010010, %10010000
    db %00100010, %10001000
    db %00111110, %11111000
    ;frame1
    db %00000100, %10000000
    db %00000110, %11010000
    db %00000110, %11011000
    db %00000111, %11111000
    db %00000100, %00111000
    db %00000110, %10101000
    db %00000100, %00001000
    db %00000101, %10010000
    db %00000010, %00100000
    db %00001111, %11110000
    db %00011100, %01111000
    db %00010110, %01100100
    db %00011110, %01111100
    db %00010010, %11000100
    db %00001010, %10001000
    db %00000111, %10001000
    db %00001111, %11110000
    db %00011110, %11100000
    db %00011100, %01110000
    db %00100100, %11110000
    db %00100101, %11100000
    db %00100101, %00100000
    db %00011000, %10010000
    db %00000000, %01110000
    ;frame2
    db %00000010, %01000000
    db %00010011, %01100000
    db %00010111, %11100000
    db %00011111, %11100000
    db %00011100, %00100000
    db %00011001, %01100000
    db %00010000, %00100000
    db %00001001, %10100000
    db %00000100, %01000000
    db %00001111, %11110000
    db %00011110, %00111000
    db %00100110, %01101000
    db %00111110, %01111000
    db %00100011, %01001000
    db %00010001, %01010000
    db %00010001, %11100000
    db %00001111, %11110000
    db %00000111, %01111000
    db %00001110, %00111000
    db %00001111, %00100100
    db %00000111, %10100100
    db %00000100, %10100100
    db %00001001, %00011000
    db %00001110, %00000000
playersprite_left:
    ;frame0
    db %00001001, %00100000
    db %00001101, %10100000
    db %00001111, %11110000
    db %00000111, %11110000
    db %00000100, %01111100
    db %00000101, %00111000
    db %00001000, %00010000
    db %00000111, %00100000
    db %00000010, %01000000
    db %00000001, %11100000
    db %00000010, %11110000
    db %00000010, %10010000
    db %00000100, %11110000
    db %00000100, %10010000
    db %00000101, %00100000
    db %00000111, %00100000
    db %00000011, %11100000
    db %00000011, %11000000
    db %00000011, %10000000
    db %00000001, %11000000
    db %00000001, %11000000
    db %00000010, %01000000
    db %00000100, %01000000
    db %00000111, %11000000
    ;frame1
    db %00000000, %00000000
    db %00000001, %00100000
    db %00000001, %10110000
    db %00001111, %11110000
    db %00000111, %11111110
    db %00000010, %00111100
    db %00000010, %10011000
    db %00000100, %00001100
    db %00000011, %10010000
    db %00000001, %00100000
    db %00000000, %11110000
    db %00000011, %01111000
    db %00000110, %11100100
    db %00011010, %10011100
    db %00100010, %10000100
    db %00100110, %11000100
    db %00011010, %01111000
    db %00000011, %11110000
    db %00000111, %11111000
    db %00000111, %01110100
    db %00000011, %11100100
    db %00000010, %01010100
    db %00000100, %10001000
    db %00000111, %00000000
    ;frame2
    db %00000000, %00000000
    db %00001001, %00100000
    db %00001101, %10101000
    db %00000111, %11111000
    db %00000111, %11110000
    db %00000100, %01111100
    db %00000101, %00110000
    db %00001000, %00011000
    db %00000111, %00101000
    db %00000010, %01000000
    db %00001101, %11100000
    db %00010011, %10110000
    db %00010000, %01010000
    db %00001100, %00100000
    db %00000111, %11100000
    db %00000101, %11100000
    db %00000100, %11100000
    db %00000111, %11100000
    db %00001111, %11110000
    db %00001110, %11101000
    db %00000111, %11001000
    db %00000100, %10101000
    db %00001001, %00010000
    db %00001110, %00000000
playersprite_right:
    ;frame0
    db %00000100, %10010000
    db %00000101, %10110000
    db %00001111, %11110000
    db %00001111, %11100000
    db %00111110, %00100000
    db %00011100, %10100000
    db %00001000, %00010000
    db %00000100, %11100000
    db %00000010, %01000000
    db %00000111, %10000000
    db %00001111, %01000000
    db %00001001, %01000000
    db %00001111, %00100000
    db %00001001, %00100000
    db %00000100, %10100000
    db %00000100, %11100000
    db %00000111, %11000000
    db %00000011, %11000000
    db %00000001, %11000000
    db %00000011, %10000000
    db %00000011, %10000000
    db %00000010, %01000000
    db %00000010, %00100000
    db %00000011, %11100000
    ;frame1
    db %00000000, %00000000
    db %00000100, %10000000
    db %00001101, %10000000
    db %00001111, %11110000
    db %01111111, %11100000
    db %00111100, %01000000
    db %00011001, %01000000
    db %00110000, %00100000
    db %00001001, %11000000
    db %00000100, %10000000
    db %00001111, %00000000
    db %00011110, %11000000
    db %00100111, %01100000
    db %00111001, %01011000
    db %00100001, %01000100
    db %00100011, %01100100
    db %00011110, %01011000
    db %00001111, %11000000
    db %00011111, %11100000
    db %00101110, %11100000
    db %00100111, %11000000
    db %00101010, %01000000
    db %00010001, %00100000
    db %00000000, %11100000
    ;frame2
    db %00000000, %00000000
    db %00000100, %10010000
    db %00010101, %10110000
    db %00011111, %11100000
    db %00001111, %11100000
    db %00111110, %00100000
    db %00001100, %10100000
    db %00011000, %00010000
    db %00010100, %11100000
    db %00000010, %01000000
    db %00000111, %10110000
    db %00001101, %11001000
    db %00001010, %00001000
    db %00000100, %00110000
    db %00000111, %11100000
    db %00000111, %10100000
    db %00000111, %00100000
    db %00000111, %11100000
    db %00001111, %11110000
    db %00010111, %01110000
    db %00010011, %11100000
    db %00010101, %00100000
    db %00001000, %10010000
    db %00000000, %01110000
;
playersprite_down_ski:
    db %00010101, %01010000
    db %00011111, %11110000
    db %01011000, %00110010
    db %01011010, %10110010
    db %01001000, %00100010
    db %01000101, %10100010
    db %01011110, %01111010
    db %01111111, %11111110
    db %01111100, %01111110
    db %11011100, %01110011
    db %11111100, %01111111
    db %11111110, %11111111
    db %01001110, %11110010
    db %01001111, %11110010
    db %01111111, %11111110
    db %00001110, %11100000
    db %00001100, %01100000
    db %00001110, %11100000
    db %00001110, %11100000
    db %00001010, %10100000
    db %00001010, %10100000
    db %00001010, %10100000
    db %00001010, %10100000
    db %00001110, %11100000
;
playersprite_dl_ski:
    db %00000001, %01010100
    db %00000011, %11111100
    db %00000010, %00001100
    db %00000011, %01001101
    db %00000010, %00001001
    db %00000001, %11001010
    db %00000111, %00011110
    db %00001111, %11111110
    db %00011111, %00011111
    db %00010111, %00011101
    db %00011111, %00011101
    db %00011111, %10111111
    db %00010111, %10110011
    db %00010111, %11110010
    db %00001111, %11111110
    db %00000011, %10111100
    db %00000011, %10011000
    db %00000011, %10111100
    db %00000111, %10111100
    db %00001001, %00100100
    db %00010010, %01001000
    db %00100100, %10010000
    db %01001001, %00100000
    db %01110001, %11000000
;
playersprite_dr_ski:
    db %00101010, %10000000
    db %00111111, %11000000
    db %00110000, %01000000
    db %10110010, %11000000
    db %10010000, %01000000
    db %01010011, %10000000
    db %01111000, %11100000
    db %01111111, %11110000
    db %11111000, %11111000
    db %10111000, %11101000
    db %10111000, %11111000
    db %11111101, %11111000
    db %11001101, %11101000
    db %01001111, %11101000
    db %01111111, %11110000
    db %00111101, %11000000
    db %00011001, %11000000
    db %00111101, %11000000
    db %00111101, %11100000
    db %00100100, %10010000
    db %00010010, %01001000
    db %00001001, %00100100
    db %00000100, %10010010
    db %00000011, %10001110
;
playersprite_r_ski:
    db %10101010, %00000000
    db %11111111, %00000000
    db %11110001, %00000000
    db %11101011, %00000000
    db %01100001, %00000000
    db %01101110, %00000000
    db %01100011, %11111110
    db %11111111, %10110010
    db %11001011, %11111110
    db %11111011, %00000100
    db %01111011, %00000100
    db %01111111, %00000100
    db %11111111, %00000100
    db %11111111, %00000100
    db %11111111, %00000100
    db %01110111, %00000100
    db %01110111, %00001110
    db %01110111, %00000000
    db %11111111, %11111111
    db %01110111, %10000001
    db %01111111, %11111110
    db %11111111, %11111111
    db %01111000, %00000010
    db %11111111, %11111100
;
playersprite_l_ski:
    db %00000000, %01010101
    db %00000000, %11111111
    db %00000000, %10001111
    db %00000000, %11010111
    db %00000000, %10000110
    db %00000000, %01110110
    db %01111111, %11000110
    db %01001101, %11111111
    db %01111111, %11011111
    db %00100000, %11010011
    db %00100000, %11011110
    db %00100000, %11111110
    db %00100000, %11111111
    db %00100000, %11111111
    db %00100000, %11111111
    db %00100000, %11101110
    db %01110000, %11101110
    db %00000000, %11101110
    db %11111111, %11111111
    db %10000001, %11101110
    db %01111111, %11111110
    db %11111111, %11111111
    db %01000000, %00011110
    db %00111111, %11111111
;
playersprite_dead_ski:
    db %00000000, %00000000
    db %00001001, %00100000
    db %00101101, %10110000
    db %00111101, %10110000
    db %00111111, %11110000
    db %00011000, %00110000
    db %00011010, %10110000
    db %00001000, %00100000
    db %11101011, %10100111
    db %10011011, %10111001
    db %10001000, %00110001
    db %01000111, %11100010
    db %00100011, %11000100
    db %01110001, %10001110
    db %11101011, %00010111
    db %11001110, %00110011
    db %00001100, %01110000
    db %00001000, %10110000
    db %00010001, %00010000
    db %00100010, %10001000
    db %01000100, %01000100
    db %10001000, %00100010
    db %01010000, %00010100
    db %00100000, %00001000
;
playersprite_ski_icon:
    db %01100110
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    ;
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    db %10011001
    db %11111111
;


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;public update loop for the player
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
player_update:
    ld a,(game_state)
    cp LEVEL_01
    call z,player_update_l1
    ld a,(game_state)
    cp LEVEL_02
    call z,player_update_l2
    ret
;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;public draw loop for the player
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
player_draw:
    call plyr_paint
    ld a,(game_state)
    cp LEVEL_01
    call z,drawplayer_l1
    ld a,(game_state)
    cp LEVEL_02
    call z,drawplayer_l2
    ret
;

plyr_paint:
    ld b,PLAYER_INK_COLOUR
    ld de,(playery)
    call paint_sprite_2_3
    ret

skip_to_next_frame:
    ld a,(player_current_frame)
    cp 0
    jp z, setframe1
    cp 1
    jp z,setframe2
    cp 2
    jp z,setframe3
    cp 3
    jp z,setframe0
    xor a
    ld (player_anim_timer),a
    ret

setframe0:
    xor a
    ld (player_current_frame),a
    ret

setframe1:
    ld a,1
    ld (player_current_frame),a
    ret

setframe2:
    ld a,2
    ld (player_current_frame),a
    ret

setframe3:
    ld a,3
    ld (player_current_frame),a
    ret

set_state_noski:
    ld a,NO_SKI
    ld (player_state),a
    ret

set_state_withski:
    ld a,WITH_SKI
    ld (player_state),a
    ret

set_state_skiingwaiting:
    ld a,SKIING_WAITING
    ld (player_state),a
    ret
set_state_skiing:
    ld a,SKIING
    ld (player_state),a
    ret

set_state_dead:
    ld a,PLAYER_DEAD
    ld (player_state),a
    ret

set_direction_up:
    ld a,UP
    ld (player_direction),a
    ret

set_direction_down:
    ld a,DOWN
    ld (player_direction),a
    ret

set_direction_left:
    ld a,LEFT
    ld (player_direction),a
    ret

set_direction_right:
    ld a,RIGHT
    ld (player_direction),a
    ret

set_direction_diagleft:
    ld a,DIAG_LEFT
    ld (player_direction),a
    ret
    
set_direction_diagright:
    ld a,DIAG_RIGHT
    ld (player_direction),a
    ret